# line_flows.md ‚Äî LINE OA Flow Design (Complete)

**System**: Student Mental Health Early Warning Platform  
**Primary Channel**: LINE Official Account  
**LIFF**: ‡πÉ‡∏ä‡πâ‡∏™‡∏≥‡∏´‡∏£‡∏±‡∏ö Screening Form + Booking UI  
**Bot Framework**: LINE Messaging API (Webhook)

---

## 0) Flow Overview

```
                 ‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê
                 ‚îÇ   ‡∏ô‡∏®. ‡πÄ‡∏û‡∏¥‡πà‡∏°‡πÄ‡∏û‡∏∑‡πà‡∏≠‡∏ô LINE OA ‚îÇ
                 ‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚î¨‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò
                            ‚ñº
              ‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê
              ‚îÇ  Follow Event ‚Üí Welcome  ‚îÇ
              ‚îÇ  "‡∏™‡∏ß‡∏±‡∏™‡∏î‡∏µ! ‡∏¢‡∏¥‡∏ô‡∏î‡∏µ‡∏ï‡πâ‡∏≠‡∏ô‡∏£‡∏±‡∏ö..."  ‚îÇ
              ‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚î¨‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò
                         ‚ñº
              ‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê
              ‚îÇ  ‡∏¢‡∏∑‡∏ô‡∏¢‡∏±‡∏ô‡∏ï‡∏±‡∏ß‡∏ï‡∏ô (LIFF)                     ‚îÇ
              ‚îÇ  ‡∏£‡∏´‡∏±‡∏™‡∏ô‡∏®. + ‡∏ß‡∏±‡∏ô‡πÄ‡∏Å‡∏¥‡∏î                      ‚îÇ
              ‚îÇ  + ‡∏ö‡∏±‡∏ï‡∏£‡∏õ‡∏£‡∏∞‡∏ä‡∏≤‡∏ä‡∏ô/‡∏ö‡∏±‡∏ï‡∏£‡∏ä‡∏°‡∏û‡∏π (Thai)           ‚îÇ
              ‚îÇ  + ‡∏´‡∏£‡∏∑‡∏≠ Passport (‡∏ï‡πà‡∏≤‡∏á‡∏ä‡∏≤‡∏ï‡∏¥)              ‚îÇ
              ‚îÇ  ‚Üí POST /students/link-line              ‚îÇ
              ‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚î¨‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò
                         ‚ñº
               ‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê
               ‚îÇ  ‚úÖ Verified ‚Üí Show ‚îÇ
               ‚îÇ  Rich Menu (Full)   ‚îÇ
               ‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò
```

> **‡∏´‡∏•‡∏±‡∏Å‡∏Å‡∏≤‡∏£**: ‡∏ô‡∏±‡∏Å‡∏®‡∏∂‡∏Å‡∏©‡∏≤ **‡∏ï‡πâ‡∏≠‡∏á‡∏¢‡∏∑‡∏ô‡∏¢‡∏±‡∏ô‡∏ï‡∏±‡∏ß‡∏ï‡∏ô‡∏Å‡πà‡∏≠‡∏ô** ‡∏ñ‡∏∂‡∏á‡∏à‡∏∞‡πÄ‡∏´‡πá‡∏ô Rich Menu ‡πÄ‡∏ï‡πá‡∏°‡∏£‡∏π‡∏õ‡πÅ‡∏ö‡∏ö  
> ‡∏Å‡πà‡∏≠‡∏ô‡∏¢‡∏∑‡∏ô‡∏¢‡∏±‡∏ô ‚Üí ‡πÅ‡∏™‡∏î‡∏á Rich Menu ‡πÅ‡∏ö‡∏ö "Guest" (‡∏°‡∏µ‡πÅ‡∏Ñ‡πà‡∏õ‡∏∏‡πà‡∏° "‡∏¢‡∏∑‡∏ô‡∏¢‡∏±‡∏ô‡∏ï‡∏±‡∏ß‡∏ï‡∏ô" + "‡∏ï‡∏¥‡∏î‡∏ï‡πà‡∏≠‡∏â‡∏∏‡∏Å‡πÄ‡∏â‡∏¥‡∏ô")

---

## 1) Rich Menu Design

### 1.1 Rich Menu ‚Äî Guest (‡∏¢‡∏±‡∏á‡πÑ‡∏°‡πà‡∏¢‡∏∑‡∏ô‡∏¢‡∏±‡∏ô‡∏ï‡∏±‡∏ß‡∏ï‡∏ô)

```
‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê
‚îÇ                                         ‚îÇ
‚îÇ   üîê ‡∏¢‡∏∑‡∏ô‡∏¢‡∏±‡∏ô‡∏ï‡∏±‡∏ß‡∏ï‡∏ô    ‚îÇ  üìû ‡∏â‡∏∏‡∏Å‡πÄ‡∏â‡∏¥‡∏ô       ‚îÇ
‚îÇ   (LIFF URL)        ‚îÇ  (tel/postback)   ‚îÇ
‚îÇ                                         ‚îÇ
‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò
```

| ‡∏õ‡∏∏‡πà‡∏° | Action Type | Value |
|------|-------------|-------|
| üîê ‡∏¢‡∏∑‡∏ô‡∏¢‡∏±‡∏ô‡∏ï‡∏±‡∏ß‡∏ï‡∏ô | `uri` | `https://liff.line.me/{LIFF_VERIFY_ID}` |
| üìû ‡∏â‡∏∏‡∏Å‡πÄ‡∏â‡∏¥‡∏ô | `uri` | `tel:1323` (‡∏™‡∏≤‡∏¢‡∏î‡πà‡∏ß‡∏ô‡∏™‡∏∏‡∏Ç‡∏†‡∏≤‡∏û‡∏à‡∏¥‡∏ï) |

### 1.2 Rich Menu ‚Äî Verified (‡∏¢‡∏∑‡∏ô‡∏¢‡∏±‡∏ô‡∏ï‡∏±‡∏ß‡∏ï‡∏ô‡πÅ‡∏•‡πâ‡∏ß)

```
‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê
‚îÇ                                         ‚îÇ
‚îÇ  üß† ‡∏õ‡∏£‡∏∞‡πÄ‡∏°‡∏¥‡∏ô‡∏ï‡∏ô‡πÄ‡∏≠‡∏á  ‚îÇ  üìÖ ‡∏ô‡∏±‡∏î‡∏´‡∏°‡∏≤‡∏¢        ‚îÇ
‚îÇ                                         ‚îÇ
‚îú‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚î§
‚îÇ                                         ‚îÇ
‚îÇ  üìö ‡πÅ‡∏´‡∏•‡πà‡∏á‡∏ä‡πà‡∏ß‡∏¢‡πÄ‡∏´‡∏•‡∏∑‡∏≠ ‚îÇ  üìû ‡∏â‡∏∏‡∏Å‡πÄ‡∏â‡∏¥‡∏ô       ‚îÇ
‚îÇ                                         ‚îÇ
‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò
```

| ‡∏õ‡∏∏‡πà‡∏° | Action Type | Value |
|------|-------------|-------|
| üß† ‡∏õ‡∏£‡∏∞‡πÄ‡∏°‡∏¥‡∏ô‡∏ï‡∏ô‡πÄ‡∏≠‡∏á | `uri` | `https://liff.line.me/{LIFF_SCREENING_ID}` |
| üìÖ ‡∏ô‡∏±‡∏î‡∏´‡∏°‡∏≤‡∏¢ | `postback` | `action=booking_gate` (‚Üí Soft Gate, ‡∏î‡∏π 3.5) |
| üìö ‡πÅ‡∏´‡∏•‡πà‡∏á‡∏ä‡πà‡∏ß‡∏¢‡πÄ‡∏´‡∏•‡∏∑‡∏≠ | `postback` | `action=resources` |
| üìû ‡∏â‡∏∏‡∏Å‡πÄ‡∏â‡∏¥‡∏ô | `uri` | `tel:1323` |

### 1.3 Rich Menu Switching Logic

```
‡πÄ‡∏°‡∏∑‡πà‡∏≠ Follow Event:
  ‚Üí ‡∏ï‡∏£‡∏ß‡∏à‡∏™‡∏≠‡∏ö line_user_id ‡πÉ‡∏ô DB
  ‚Üí ‡∏ñ‡πâ‡∏≤‡∏¢‡∏±‡∏á‡πÑ‡∏°‡πà linked ‚Üí ‡∏ú‡∏π‡∏Å Rich Menu "Guest"
  ‚Üí ‡∏ñ‡πâ‡∏≤ linked ‡πÅ‡∏•‡πâ‡∏ß ‚Üí ‡∏ú‡∏π‡∏Å Rich Menu "Verified"

‡πÄ‡∏°‡∏∑‡πà‡∏≠ Link ‡∏™‡∏≥‡πÄ‡∏£‡πá‡∏à:
  ‚Üí ‡πÄ‡∏õ‡∏•‡∏µ‡πà‡∏¢‡∏ô Rich Menu ‡πÄ‡∏õ‡πá‡∏ô "Verified" ‡∏ó‡∏±‡∏ô‡∏ó‡∏µ
  ‚Üí ‡πÉ‡∏ä‡πâ LINE API: linkRichMenuToUser(userId, verifiedMenuId)
```

---

## 2) Student Onboarding (‡∏¢‡∏∑‡∏ô‡∏¢‡∏±‡∏ô‡∏ï‡∏±‡∏ß‡∏ï‡∏ô)

### 2.1 LIFF Verify Flow

```
                LIFF App (Verify)
‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê
‚îÇ                                             ‚îÇ
‚îÇ   üîê ‡∏¢‡∏∑‡∏ô‡∏¢‡∏±‡∏ô‡∏ï‡∏±‡∏ß‡∏ï‡∏ô‡∏ô‡∏±‡∏Å‡∏®‡∏∂‡∏Å‡∏©‡∏≤                   ‚îÇ
‚îÇ                                             ‚îÇ
‚îÇ   ‡∏£‡∏´‡∏±‡∏™‡∏ô‡∏±‡∏Å‡∏®‡∏∂‡∏Å‡∏©‡∏≤: [___________]               ‚îÇ
‚îÇ   ‡∏ß‡∏±‡∏ô‡πÄ‡∏Å‡∏¥‡∏î:     [DD/MM/YYYY]                ‚îÇ
‚îÇ                                             ‚îÇ
‚îÇ   ‚îÄ‚îÄ ‡πÄ‡∏•‡∏∑‡∏≠‡∏Å‡πÄ‡∏≠‡∏Å‡∏™‡∏≤‡∏£‡∏¢‡∏∑‡∏ô‡∏¢‡∏±‡∏ô‡∏ï‡∏±‡∏ß‡∏ï‡∏ô ‚îÄ‚îÄ             ‚îÇ
‚îÇ                                             ‚îÇ
‚îÇ   ‚óè ‡∏ö‡∏±‡∏ï‡∏£‡∏õ‡∏£‡∏∞‡∏ä‡∏≤‡∏ä‡∏ô / ‡∏ö‡∏±‡∏ï‡∏£‡∏ä‡∏°‡∏û‡∏π (‡∏ô‡∏®. ‡πÑ‡∏ó‡∏¢)       ‚îÇ
‚îÇ   ‚óã Passport (‡∏ô‡∏®. ‡∏ï‡πà‡∏≤‡∏á‡∏ä‡∏≤‡∏ï‡∏¥)                ‚îÇ
‚îÇ                                             ‚îÇ
‚îÇ   ‚îå‚îÄ ‡πÄ‡∏°‡∏∑‡πà‡∏≠‡πÄ‡∏•‡∏∑‡∏≠‡∏Å "‡∏ö‡∏±‡∏ï‡∏£‡∏õ‡∏£‡∏∞‡∏ä‡∏≤‡∏ä‡∏ô / ‡∏ö‡∏±‡∏ï‡∏£‡∏ä‡∏°‡∏û‡∏π" ‚îÄ‚îÄ‚îê‚îÇ
‚îÇ   ‚îÇ ‡πÄ‡∏•‡∏Ç‡∏ö‡∏±‡∏ï‡∏£ 13 ‡∏´‡∏•‡∏±‡∏Å: [_ ___ _____ __ _]   ‚îÇ‚îÇ
‚îÇ   ‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò‚îÇ
‚îÇ                                             ‚îÇ
‚îÇ   ‚îå‚îÄ ‡πÄ‡∏°‡∏∑‡πà‡∏≠‡πÄ‡∏•‡∏∑‡∏≠‡∏Å "Passport" ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê‚îÇ
‚îÇ   ‚îÇ Passport Number: [___________]         ‚îÇ‚îÇ
‚îÇ   ‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò‚îÇ
‚îÇ                                             ‚îÇ
‚îÇ   ‚òë ‡∏¢‡∏¥‡∏ô‡∏¢‡∏≠‡∏°‡πÉ‡∏´‡πâ‡∏£‡∏∞‡∏ö‡∏ö‡∏à‡∏±‡∏î‡πÄ‡∏Å‡πá‡∏ö‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•              ‚îÇ
‚îÇ     ‡πÄ‡∏û‡∏∑‡πà‡∏≠‡πÉ‡∏ä‡πâ‡∏õ‡∏£‡∏∞‡πÄ‡∏°‡∏¥‡∏ô‡∏™‡∏∏‡∏Ç‡∏†‡∏≤‡∏û‡∏à‡∏¥‡∏ï‡πÄ‡∏ö‡∏∑‡πâ‡∏≠‡∏á‡∏ï‡πâ‡∏ô        ‚îÇ
‚îÇ     (‡∏≠‡πà‡∏≤‡∏ô‡∏ô‡πÇ‡∏¢‡∏ö‡∏≤‡∏¢‡∏Ñ‡∏ß‡∏≤‡∏°‡πÄ‡∏õ‡πá‡∏ô‡∏™‡πà‡∏ß‡∏ô‡∏ï‡∏±‡∏ß)            ‚îÇ
‚îÇ                                             ‚îÇ
‚îÇ         [ ‚úÖ ‡∏¢‡∏∑‡∏ô‡∏¢‡∏±‡∏ô ]                        ‚îÇ
‚îÇ                                             ‚îÇ
‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò
```

> **UI Note**: ‡∏ü‡∏≠‡∏£‡πå‡∏°‡πÅ‡∏™‡∏î‡∏á‡∏ä‡πà‡∏≠‡∏á‡∏Å‡∏£‡∏≠‡∏Å‡πÄ‡∏≠‡∏Å‡∏™‡∏≤‡∏£‡πÄ‡∏û‡∏µ‡∏¢‡∏á 1 ‡∏ä‡πà‡∏≠‡∏á‡∏ï‡∏≤‡∏° Radio ‡∏ó‡∏µ‡πà‡πÄ‡∏•‡∏∑‡∏≠‡∏Å  
> ‡πÄ‡∏•‡∏∑‡∏≠‡∏Å "‡∏ö‡∏±‡∏ï‡∏£‡∏õ‡∏£‡∏∞‡∏ä‡∏≤‡∏ä‡∏ô/‡∏ö‡∏±‡∏ï‡∏£‡∏ä‡∏°‡∏û‡∏π" ‚Üí ‡πÅ‡∏™‡∏î‡∏á‡∏ä‡πà‡∏≠‡∏á‡πÄ‡∏•‡∏Ç 13 ‡∏´‡∏•‡∏±‡∏Å (‡∏û‡∏£‡πâ‡∏≠‡∏° mask format)  
> ‡πÄ‡∏•‡∏∑‡∏≠‡∏Å "Passport" ‚Üí ‡πÅ‡∏™‡∏î‡∏á‡∏ä‡πà‡∏≠‡∏á Passport Number (alphanumeric)

### 2.2 Verify API Call

```
LIFF ‚Üí GET LINE Profile (liff.getProfile())
     ‚Üí ‡πÑ‡∏î‡πâ line_user_id

LIFF ‚Üí POST /students/link-line

// ‡∏Å‡∏£‡∏ì‡∏µ ‡∏ö‡∏±‡∏ï‡∏£‡∏õ‡∏£‡∏∞‡∏ä‡∏≤‡∏ä‡∏ô / ‡∏ö‡∏±‡∏ï‡∏£‡∏ä‡∏°‡∏û‡∏π (‡∏ô‡∏®. ‡πÑ‡∏ó‡∏¢)
{
  "student_code": "6700001",
  "verify_doc_type": "national_id",
  "verify_token": "2005-03-15",         // ‡∏ß‡∏±‡∏ô‡πÄ‡∏Å‡∏¥‡∏î (YYYY-MM-DD)
  "verify_doc_number": "1-1234-56789-01-2",  // ‡πÄ‡∏•‡∏Ç‡∏ö‡∏±‡∏ï‡∏£ 13 ‡∏´‡∏•‡∏±‡∏Å
  "line_user_id": "U1234567890abcdef"
}

// ‡∏Å‡∏£‡∏ì‡∏µ Passport (‡∏ô‡∏®. ‡∏ï‡πà‡∏≤‡∏á‡∏ä‡∏≤‡∏ï‡∏¥)
{
  "student_code": "6700099",
  "verify_doc_type": "passport",
  "verify_token": "2003-07-22",         // ‡∏ß‡∏±‡∏ô‡πÄ‡∏Å‡∏¥‡∏î (YYYY-MM-DD)
  "verify_doc_number": "AB1234567",     // Passport Number
  "line_user_id": "U1234567890abcdef"
}
```

### 2.3 Verify Fields Spec

| Field | Type | Required | Description |
|-------|------|----------|-------------|
| `student_code` | string | ‚úÖ | ‡∏£‡∏´‡∏±‡∏™‡∏ô‡∏±‡∏Å‡∏®‡∏∂‡∏Å‡∏©‡∏≤ |
| `verify_doc_type` | enum | ‚úÖ | `national_id` (‡∏ö‡∏±‡∏ï‡∏£ ‡∏õ‡∏ä‡∏ä./‡∏ä‡∏°‡∏û‡∏π) ‡∏´‡∏£‡∏∑‡∏≠ `passport` |
| `verify_token` | string | ‚úÖ | ‡∏ß‡∏±‡∏ô‡πÄ‡∏Å‡∏¥‡∏î format YYYY-MM-DD |
| `verify_doc_number` | string | ‚úÖ | ‡πÄ‡∏•‡∏Ç‡∏ö‡∏±‡∏ï‡∏£ 13 ‡∏´‡∏•‡∏±‡∏Å ‡∏´‡∏£‡∏∑‡∏≠ Passport Number |
| `line_user_id` | string | ‚úÖ | ‡∏à‡∏≤‡∏Å liff.getProfile() |

### 2.4 Frontend Validation (LIFF)

| Field | Validation |
|-------|------------|
| `student_code` | ‡∏ï‡πâ‡∏≠‡∏á‡πÑ‡∏°‡πà‡∏ß‡πà‡∏≤‡∏á, ‡∏ï‡∏±‡∏ß‡πÄ‡∏•‡∏Ç, 7-10 ‡∏´‡∏•‡∏±‡∏Å |
| `verify_token` (‡∏ß‡∏±‡∏ô‡πÄ‡∏Å‡∏¥‡∏î) | valid date, ‡∏≠‡∏≤‡∏¢‡∏∏ 15-60 ‡∏õ‡∏µ |
| `verify_doc_number` (national_id) | ‡∏ï‡∏±‡∏ß‡πÄ‡∏•‡∏Ç 13 ‡∏´‡∏•‡∏±‡∏Å, checksum digit |
| `verify_doc_number` (passport) | alphanumeric, 5-15 ‡∏ï‡∏±‡∏ß‡∏≠‡∏±‡∏Å‡∏©‡∏£ |

### 2.5 Backend Verification Logic

```
1) ‡∏ï‡∏£‡∏ß‡∏à student_code ‚Üí ‡∏´‡∏≤‡πÉ‡∏ô‡∏ï‡∏≤‡∏£‡∏≤‡∏á public.students
2) ‡∏ï‡∏£‡∏ß‡∏à verify_token (‡∏ß‡∏±‡∏ô‡πÄ‡∏Å‡∏¥‡∏î) ‚Üí hash ‡πÅ‡∏•‡πâ‡∏ß‡πÄ‡∏ó‡∏µ‡∏¢‡∏ö‡∏Å‡∏±‡∏ö dob_hash ‡πÉ‡∏ô DB
3) ‡∏ï‡∏£‡∏ß‡∏à verify_doc_number:
   - ‡∏ñ‡πâ‡∏≤ national_id ‚Üí hash ‡πÅ‡∏•‡πâ‡∏ß‡πÄ‡∏ó‡∏µ‡∏¢‡∏ö‡∏Å‡∏±‡∏ö id_card_hash ‡πÉ‡∏ô DB
   - ‡∏ñ‡πâ‡∏≤ passport   ‚Üí hash ‡πÅ‡∏•‡πâ‡∏ß‡πÄ‡∏ó‡∏µ‡∏¢‡∏ö‡∏Å‡∏±‡∏ö passport_hash ‡πÉ‡∏ô DB
4) ‡∏ñ‡πâ‡∏≤‡∏ú‡πà‡∏≤‡∏ô‡∏ó‡∏±‡πâ‡∏á 3 ‡∏Ç‡πâ‡∏≠ ‚Üí ‡∏™‡∏£‡πâ‡∏≤‡∏á line_link record
5) ‡∏ñ‡πâ‡∏≤‡πÑ‡∏°‡πà‡∏ú‡πà‡∏≤‡∏ô ‚Üí return error (‡πÑ‡∏°‡πà‡∏ö‡∏≠‡∏Å‡∏ß‡πà‡∏≤‡∏Ç‡πâ‡∏≠‡πÑ‡∏´‡∏ô‡∏ú‡∏¥‡∏î ‡πÄ‡∏û‡∏∑‡πà‡∏≠‡∏Ñ‡∏ß‡∏≤‡∏°‡∏õ‡∏•‡∏≠‡∏î‡∏†‡∏±‡∏¢)
```

### 2.6 Response Handling

| ‡∏™‡∏ñ‡∏≤‡∏ô‡∏∞ | Error Code | Bot Reply |
|--------|-----------|-----------|
| ‚úÖ ‡∏™‡∏≥‡πÄ‡∏£‡πá‡∏à | ‚Äî | "‡∏¢‡∏∑‡∏ô‡∏¢‡∏±‡∏ô‡∏ï‡∏±‡∏ß‡∏ï‡∏ô‡∏™‡∏≥‡πÄ‡∏£‡πá‡∏à üéâ ‡∏Ñ‡∏∏‡∏ì‡∏™‡∏≤‡∏°‡∏≤‡∏£‡∏ñ‡πÉ‡∏ä‡πâ‡∏á‡∏≤‡∏ô‡∏£‡∏∞‡∏ö‡∏ö‡πÑ‡∏î‡πâ‡πÄ‡∏•‡∏¢" + ‡∏™‡∏•‡∏±‡∏ö Rich Menu |
| ‚ùå ‡πÑ‡∏°‡πà‡∏û‡∏ö‡∏£‡∏´‡∏±‡∏™ | `STUDENT_NOT_FOUND` | "‡πÑ‡∏°‡πà‡∏û‡∏ö‡∏£‡∏´‡∏±‡∏™‡∏ô‡∏±‡∏Å‡∏®‡∏∂‡∏Å‡∏©‡∏≤‡πÉ‡∏ô‡∏£‡∏∞‡∏ö‡∏ö ‡∏Å‡∏£‡∏∏‡∏ì‡∏≤‡∏ï‡∏£‡∏ß‡∏à‡∏™‡∏≠‡∏ö‡∏≠‡∏µ‡∏Å‡∏Ñ‡∏£‡∏±‡πâ‡∏á" |
| ‚ùå ‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡πÑ‡∏°‡πà‡∏ï‡∏£‡∏á | `VERIFY_FAILED` | "‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡πÑ‡∏°‡πà‡∏ï‡∏£‡∏á‡∏Å‡∏±‡∏ô ‡∏Å‡∏£‡∏∏‡∏ì‡∏≤‡∏ï‡∏£‡∏ß‡∏à‡∏™‡∏≠‡∏ö‡∏ß‡∏±‡∏ô‡πÄ‡∏Å‡∏¥‡∏î‡πÅ‡∏•‡∏∞‡πÄ‡∏•‡∏Ç‡πÄ‡∏≠‡∏Å‡∏™‡∏≤‡∏£‡∏≠‡∏µ‡∏Å‡∏Ñ‡∏£‡∏±‡πâ‡∏á" |
| ‚ùå ‡∏ú‡∏π‡∏Å‡πÅ‡∏•‡πâ‡∏ß | `ALREADY_LINKED` | "‡∏ö‡∏±‡∏ç‡∏ä‡∏µ‡∏ô‡∏µ‡πâ‡∏ú‡∏π‡∏Å‡∏Å‡∏±‡∏ö LINE ‡πÅ‡∏•‡πâ‡∏ß ‡∏´‡∏≤‡∏Å‡∏°‡∏µ‡∏õ‡∏±‡∏ç‡∏´‡∏≤‡∏Å‡∏£‡∏∏‡∏ì‡∏≤‡∏ï‡∏¥‡∏î‡∏ï‡πà‡∏≠‡πÄ‡∏à‡πâ‡∏≤‡∏´‡∏ô‡πâ‡∏≤‡∏ó‡∏µ‡πà" |
| ‚ùå ‡∏•‡∏≠‡∏á‡∏ö‡πà‡∏≠‡∏¢‡πÄ‡∏Å‡∏¥‡∏ô | `RATE_LIMITED` | "‡∏Å‡∏£‡∏∏‡∏ì‡∏≤‡∏£‡∏≠‡∏™‡∏±‡∏Å‡∏Ñ‡∏£‡∏π‡πà‡πÅ‡∏•‡πâ‡∏ß‡∏•‡∏≠‡∏á‡πÉ‡∏´‡∏°‡πà‡∏≠‡∏µ‡∏Å‡∏Ñ‡∏£‡∏±‡πâ‡∏á" |
| ‚ùå ‡πÄ‡∏•‡∏Ç‡∏ö‡∏±‡∏ï‡∏£‡∏ú‡∏¥‡∏î format | `VALIDATION_ERROR` | "‡∏£‡∏π‡∏õ‡πÅ‡∏ö‡∏ö‡πÄ‡∏•‡∏Ç‡πÄ‡∏≠‡∏Å‡∏™‡∏≤‡∏£‡πÑ‡∏°‡πà‡∏ñ‡∏π‡∏Å‡∏ï‡πâ‡∏≠‡∏á ‡∏Å‡∏£‡∏∏‡∏ì‡∏≤‡∏ï‡∏£‡∏ß‡∏à‡∏™‡∏≠‡∏ö‡∏≠‡∏µ‡∏Å‡∏Ñ‡∏£‡∏±‡πâ‡∏á" |

### 2.7 Security Rules

- Rate limit: **5 ‡∏Ñ‡∏£‡∏±‡πâ‡∏á / 15 ‡∏ô‡∏≤‡∏ó‡∏µ** ‡∏ï‡πà‡∏≠ line_user_id
- Log ‡∏ó‡∏∏‡∏Å attempt ‡∏•‡∏á `audit_log` (‡πÑ‡∏°‡πà log ‡πÄ‡∏•‡∏Ç‡∏ö‡∏±‡∏ï‡∏£/passport)
- verify_token (‡∏ß‡∏±‡∏ô‡πÄ‡∏Å‡∏¥‡∏î) + verify_doc_number ‚Üí **hash (SHA-256 + salt) ‡∏Å‡πà‡∏≠‡∏ô‡πÄ‡∏õ‡∏£‡∏µ‡∏¢‡∏ö‡πÄ‡∏ó‡∏µ‡∏¢‡∏ö** (‡πÑ‡∏°‡πà‡πÄ‡∏Å‡πá‡∏ö plain text ‡πÉ‡∏ô DB)
- Error response **‡πÑ‡∏°‡πà‡∏£‡∏∞‡∏ö‡∏∏‡∏ß‡πà‡∏≤‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡πÉ‡∏î‡∏ú‡∏¥‡∏î** (‡∏õ‡πâ‡∏≠‡∏á‡∏Å‡∏±‡∏ô enumeration attack)
- consent_version + consented_at ‡∏ö‡∏±‡∏ô‡∏ó‡∏∂‡∏Å‡∏ó‡∏∏‡∏Å‡∏Ñ‡∏£‡∏±‡πâ‡∏á
- ‡πÄ‡∏•‡∏Ç‡∏ö‡∏±‡∏ï‡∏£‡∏õ‡∏£‡∏∞‡∏ä‡∏≤‡∏ä‡∏ô/passport **‡πÑ‡∏°‡πà‡πÄ‡∏Å‡πá‡∏ö‡πÉ‡∏ô LINE chat log** (‡∏Å‡∏£‡∏≠‡∏Å‡∏ú‡πà‡∏≤‡∏ô LIFF ‡πÄ‡∏ó‡πà‡∏≤‡∏ô‡∏±‡πâ‡∏ô)

---

## 3) Screening Flow (LIFF)

### 3.1 Entry Points

| ‡∏à‡∏∏‡∏î‡πÄ‡∏Ç‡πâ‡∏≤ | ‡∏ß‡∏¥‡∏ò‡∏µ |
|---------|------|
| Rich Menu "‡∏õ‡∏£‡∏∞‡πÄ‡∏°‡∏¥‡∏ô‡∏ï‡∏ô‡πÄ‡∏≠‡∏á" | ‡∏Å‡∏î‡∏õ‡∏∏‡πà‡∏° ‚Üí ‡πÄ‡∏õ‡∏¥‡∏î LIFF Screening |
| Bot ‡πÅ‡∏ô‡∏∞‡∏ô‡∏≥ | Flex Message CTA ‚Üí ‡πÄ‡∏õ‡∏¥‡∏î LIFF |
| ‡∏û‡∏¥‡∏°‡∏û‡πå "‡∏õ‡∏£‡∏∞‡πÄ‡∏°‡∏¥‡∏ô" | Bot ‡∏ï‡∏≠‡∏ö Flex Message ‡∏û‡∏£‡πâ‡∏≠‡∏°‡∏•‡∏¥‡∏á‡∏Å‡πå LIFF |

### 3.2 LIFF Screening UI

```
               LIFF App (Screening)
‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê
‚îÇ                                         ‚îÇ
‚îÇ   üß† ‡∏õ‡∏£‡∏∞‡πÄ‡∏°‡∏¥‡∏ô‡∏™‡∏∏‡∏Ç‡∏†‡∏≤‡∏û‡∏à‡∏¥‡∏ï‡πÄ‡∏ö‡∏∑‡πâ‡∏≠‡∏á‡∏ï‡πâ‡∏ô         ‚îÇ
‚îÇ                                         ‚îÇ
‚îÇ   ‡∏Å‡∏£‡∏∏‡∏ì‡∏≤‡πÄ‡∏•‡∏∑‡∏≠‡∏Å‡πÅ‡∏ö‡∏ö‡∏õ‡∏£‡∏∞‡πÄ‡∏°‡∏¥‡∏ô:                ‚îÇ
‚îÇ                                         ‚îÇ
‚îÇ   ‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê     ‚îÇ
‚îÇ   ‚îÇ ‚ö° ‡∏õ‡∏£‡∏∞‡πÄ‡∏°‡∏¥‡∏ô‡πÄ‡∏£‡πá‡∏ß (3-5 ‡∏Ç‡πâ‡∏≠)      ‚îÇ     ‚îÇ
‚îÇ   ‚îÇ    ‡πÉ‡∏ä‡πâ‡πÄ‡∏ß‡∏•‡∏≤ ~2 ‡∏ô‡∏≤‡∏ó‡∏µ            ‚îÇ     ‚îÇ
‚îÇ   ‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò     ‚îÇ
‚îÇ                                         ‚îÇ
‚îÇ   ‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê     ‚îÇ
‚îÇ   ‚îÇ üìã ‡∏õ‡∏£‡∏∞‡πÄ‡∏°‡∏¥‡∏ô‡πÅ‡∏ö‡∏ö‡πÄ‡∏ï‡πá‡∏°             ‚îÇ     ‚îÇ
‚îÇ   ‚îÇ    PHQ-9 + GAD-7 (16 ‡∏Ç‡πâ‡∏≠)    ‚îÇ     ‚îÇ
‚îÇ   ‚îÇ    ‡πÉ‡∏ä‡πâ‡πÄ‡∏ß‡∏•‡∏≤ ~5-10 ‡∏ô‡∏≤‡∏ó‡∏µ         ‚îÇ     ‚îÇ
‚îÇ   ‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò     ‚îÇ
‚îÇ                                         ‚îÇ
‚îÇ   üîí ‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡πÄ‡∏õ‡πá‡∏ô‡∏Ñ‡∏ß‡∏≤‡∏°‡∏•‡∏±‡∏ö                 ‚îÇ
‚îÇ   ‡∏ú‡∏•‡∏õ‡∏£‡∏∞‡πÄ‡∏°‡∏¥‡∏ô‡πÑ‡∏°‡πà‡∏™‡πà‡∏á‡πÉ‡∏´‡πâ‡∏≠‡∏≤‡∏à‡∏≤‡∏£‡∏¢‡πå‡∏ó‡∏µ‡πà‡∏õ‡∏£‡∏∂‡∏Å‡∏©‡∏≤    ‚îÇ
‚îÇ                                         ‚îÇ
‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò
```

### 3.3 Screening Submit (LIFF ‚Üí Backend)

```
LIFF ‚Üí POST /screenings
{
  "student_id": "uuid",         // ‡∏à‡∏≤‡∏Å LIFF profile mapping
  "type": "phq9_gad7",          // ‡∏´‡∏£‡∏∑‡∏≠ "stress_mini"
  "intent": "stress",           // academic | stress | relationship | sleep | other | unsure
  "answers": {
    "phq9": [0,1,2,0,1,0,1,0,0],
    "gad7": [1,1,0,1,0,0,1]
  }
}
```

### 3.4 Result ‚Üí Bot Message (via LIFF sendMessages or Webhook push)

**LIFF ‡∏õ‡∏¥‡∏î‡∏ï‡∏±‡∏ß‡πÄ‡∏≠‡∏á ‚Üí Bot push Flex Message ‡∏ú‡∏•‡∏õ‡∏£‡∏∞‡πÄ‡∏°‡∏¥‡∏ô**

#### Result: LOW
```json
{
  "type": "flex",
  "altText": "‡∏ú‡∏•‡∏Å‡∏≤‡∏£‡∏õ‡∏£‡∏∞‡πÄ‡∏°‡∏¥‡∏ô‡∏™‡∏∏‡∏Ç‡∏†‡∏≤‡∏û‡∏à‡∏¥‡∏ï",
  "contents": {
    "type": "bubble",
    "header": { "text": "‡∏ú‡∏•‡∏Å‡∏≤‡∏£‡∏õ‡∏£‡∏∞‡πÄ‡∏°‡∏¥‡∏ô üåø" },
    "body": {
      "text": "‡∏Ñ‡∏∏‡∏ì‡∏≠‡∏¢‡∏π‡πà‡πÉ‡∏ô‡∏£‡∏∞‡∏î‡∏±‡∏ö '‡∏õ‡∏Å‡∏ï‡∏¥'\n‡πÄ‡∏£‡∏≤‡∏î‡∏µ‡πÉ‡∏à‡∏ó‡∏µ‡πà‡∏Ñ‡∏∏‡∏ì‡∏î‡∏π‡πÅ‡∏•‡∏ï‡∏±‡∏ß‡πÄ‡∏≠‡∏á!\n\n‡∏•‡∏≠‡∏á‡∏î‡∏π‡πÅ‡∏ö‡∏ö‡∏ù‡∏∂‡∏Å‡∏´‡∏±‡∏î‡πÄ‡∏´‡∏•‡πà‡∏≤‡∏ô‡∏µ‡πâ‡πÄ‡∏û‡∏∑‡πà‡∏≠‡∏£‡∏±‡∏Å‡∏©‡∏≤‡∏™‡∏∏‡∏Ç‡∏†‡∏≤‡∏û‡∏à‡∏¥‡∏ï‡∏ó‡∏µ‡πà‡∏î‡∏µ"
    },
    "footer": {
      "actions": [
        { "type": "postback", "label": "üìö ‡πÅ‡∏´‡∏•‡πà‡∏á‡∏ä‡πà‡∏ß‡∏¢‡πÄ‡∏´‡∏•‡∏∑‡∏≠", "data": "action=resources" },
        { "type": "postback", "label": "üìÖ ‡∏ô‡∏±‡∏î‡∏û‡∏ö‡∏ó‡∏µ‡πà‡∏õ‡∏£‡∏∂‡∏Å‡∏©‡∏≤ (optional)", "data": "action=book&type=advisor" }
      ]
    }
  }
}
```

#### Result: MODERATE
```json
{
  "type": "flex",
  "altText": "‡∏ú‡∏•‡∏Å‡∏≤‡∏£‡∏õ‡∏£‡∏∞‡πÄ‡∏°‡∏¥‡∏ô‡∏™‡∏∏‡∏Ç‡∏†‡∏≤‡∏û‡∏à‡∏¥‡∏ï",
  "contents": {
    "type": "bubble",
    "header": { "text": "‡∏ú‡∏•‡∏Å‡∏≤‡∏£‡∏õ‡∏£‡∏∞‡πÄ‡∏°‡∏¥‡∏ô üíõ" },
    "body": {
      "text": "‡∏î‡∏π‡πÄ‡∏´‡∏°‡∏∑‡∏≠‡∏ô‡∏Ñ‡∏∏‡∏ì‡∏Å‡∏≥‡∏•‡∏±‡∏á‡πÄ‡∏ú‡∏ä‡∏¥‡∏ç‡∏Å‡∏±‡∏ö‡∏Ñ‡∏ß‡∏≤‡∏°‡πÄ‡∏Ñ‡∏£‡∏µ‡∏¢‡∏î‡∏≠‡∏¢‡∏π‡πà‡∏ö‡πâ‡∏≤‡∏á\n‡πÄ‡∏£‡∏≤‡∏≠‡∏¢‡∏≤‡∏Å‡∏ä‡πà‡∏ß‡∏¢‡πÉ‡∏´‡πâ‡∏Ñ‡∏∏‡∏ì‡πÑ‡∏î‡πâ‡∏û‡∏π‡∏î‡∏Ñ‡∏∏‡∏¢‡∏Å‡∏±‡∏ö‡∏ú‡∏π‡πâ‡πÄ‡∏ä‡∏µ‡πà‡∏¢‡∏ß‡∏ä‡∏≤‡∏ç\n\n‡∏Ñ‡∏∏‡∏ì‡πÑ‡∏°‡πà‡πÑ‡∏î‡πâ‡∏≠‡∏¢‡∏π‡πà‡∏Ñ‡∏ô‡πÄ‡∏î‡∏µ‡∏¢‡∏ß"
    },
    "footer": {
      "actions": [
        { "type": "uri", "label": "üìÖ ‡∏à‡∏≠‡∏á‡∏û‡∏ö‡∏ô‡∏±‡∏Å‡∏à‡∏¥‡∏ï‡∏ß‡∏¥‡∏ó‡∏¢‡∏≤", "uri": "https://liff.line.me/{LIFF_BOOKING_ID}?type=counselor" },
        { "type": "uri", "label": "üìÖ ‡∏û‡∏ö‡∏≠‡∏≤‡∏à‡∏≤‡∏£‡∏¢‡πå‡∏ó‡∏µ‡πà‡∏õ‡∏£‡∏∂‡∏Å‡∏©‡∏≤", "uri": "https://liff.line.me/{LIFF_BOOKING_ID}?type=advisor" },
        { "type": "postback", "label": "üìö ‡πÅ‡∏ö‡∏ö‡∏ù‡∏∂‡∏Å‡∏´‡∏±‡∏î‡∏•‡∏î‡πÄ‡∏Ñ‡∏£‡∏µ‡∏¢‡∏î", "data": "action=resources&category=stress" }
      ]
    }
  }
}
```

#### Result: HIGH
```json
{
  "type": "flex",
  "altText": "‡∏ú‡∏•‡∏Å‡∏≤‡∏£‡∏õ‡∏£‡∏∞‡πÄ‡∏°‡∏¥‡∏ô ‚Äî ‡πÄ‡∏£‡∏≤‡∏≠‡∏¢‡∏≤‡∏Å‡∏ä‡πà‡∏ß‡∏¢‡∏Ñ‡∏∏‡∏ì",
  "contents": {
    "type": "bubble",
    "styles": { "header": { "backgroundColor": "#FF9800" } },
    "header": { "text": "‡πÄ‡∏£‡∏≤‡∏≠‡∏¢‡∏≤‡∏Å‡∏ä‡πà‡∏ß‡∏¢‡∏Ñ‡∏∏‡∏ì üß°" },
    "body": {
      "text": "‡∏Ñ‡∏∏‡∏ì‡∏≠‡∏≤‡∏à‡∏Å‡∏≥‡∏•‡∏±‡∏á‡πÄ‡∏ú‡∏ä‡∏¥‡∏ç‡∏Å‡∏±‡∏ö‡∏™‡∏¥‡πà‡∏á‡∏ó‡∏µ‡πà‡∏´‡∏ô‡∏±‡∏Å‡∏´‡∏ô‡∏≤\n‡πÅ‡∏ï‡πà‡∏Ñ‡∏ß‡∏≤‡∏°‡∏ä‡πà‡∏ß‡∏¢‡πÄ‡∏´‡∏•‡∏∑‡∏≠‡∏û‡∏£‡πâ‡∏≠‡∏°‡∏≠‡∏¢‡∏π‡πà‡πÄ‡∏™‡∏°‡∏≠\n\n‡πÄ‡∏£‡∏≤‡πÅ‡∏ô‡∏∞‡∏ô‡∏≥‡πÉ‡∏´‡πâ‡∏û‡∏ö‡∏ô‡∏±‡∏Å‡∏à‡∏¥‡∏ï‡∏ß‡∏¥‡∏ó‡∏¢‡∏≤‡∏Ç‡∏≠‡∏á‡∏°‡∏´‡∏≤‡∏ß‡∏¥‡∏ó‡∏¢‡∏≤‡∏•‡∏±‡∏¢\n‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏ó‡∏∏‡∏Å‡∏≠‡∏¢‡πà‡∏≤‡∏á‡πÄ‡∏õ‡πá‡∏ô‡∏Ñ‡∏ß‡∏≤‡∏°‡∏•‡∏±‡∏ö üîí"
    },
    "footer": {
      "actions": [
        { "type": "uri", "label": "üìÖ ‡∏à‡∏≠‡∏á‡∏û‡∏ö‡∏ô‡∏±‡∏Å‡∏à‡∏¥‡∏ï‡∏ß‡∏¥‡∏ó‡∏¢‡∏≤ (‡πÅ‡∏ô‡∏∞‡∏ô‡∏≥)", "uri": "https://liff.line.me/{LIFF_BOOKING_ID}?type=counselor" },
        { "type": "postback", "label": "üìû ‡πÇ‡∏ó‡∏£‡∏´‡∏≤‡∏™‡∏≤‡∏¢‡∏î‡πà‡∏ß‡∏ô 1323", "data": "action=emergency_info" }
      ]
    }
  }
}
```

#### Result: CRISIS üö®
```json
{
  "type": "flex",
  "altText": "‡∏™‡∏≥‡∏Ñ‡∏±‡∏ç ‚Äî ‡∏Ñ‡∏ß‡∏≤‡∏°‡∏ä‡πà‡∏ß‡∏¢‡πÄ‡∏´‡∏•‡∏∑‡∏≠‡∏û‡∏£‡πâ‡∏≠‡∏°‡∏≠‡∏¢‡∏π‡πà",
  "contents": {
    "type": "bubble",
    "styles": { "header": { "backgroundColor": "#E53935" } },
    "header": { "text": "‡∏Ñ‡∏ß‡∏≤‡∏°‡∏ä‡πà‡∏ß‡∏¢‡πÄ‡∏´‡∏•‡∏∑‡∏≠‡∏û‡∏£‡πâ‡∏≠‡∏°‡∏≠‡∏¢‡∏π‡πà ‚ù§Ô∏è", "color": "#FFFFFF" },
    "body": {
      "text": "‡∏Ç‡∏≠‡∏ö‡∏Ñ‡∏∏‡∏ì‡∏ó‡∏µ‡πà‡πÑ‡∏ß‡πâ‡∏ß‡∏≤‡∏á‡πÉ‡∏à‡∏ö‡∏≠‡∏Å‡πÄ‡∏£‡∏≤\n‡∏Ñ‡∏∏‡∏ì‡πÑ‡∏°‡πà‡πÑ‡∏î‡πâ‡∏≠‡∏¢‡∏π‡πà‡∏Ñ‡∏ô‡πÄ‡∏î‡∏µ‡∏¢‡∏ß\n\nüî¥ ‡∏ô‡∏±‡∏Å‡∏à‡∏¥‡∏ï‡∏ß‡∏¥‡∏ó‡∏¢‡∏≤‡∏à‡∏∞‡∏ï‡∏¥‡∏î‡∏ï‡πà‡∏≠‡∏Ñ‡∏∏‡∏ì‡∏†‡∏≤‡∏¢‡πÉ‡∏ô 30 ‡∏ô‡∏≤‡∏ó‡∏µ\n\n‡∏£‡∏∞‡∏´‡∏ß‡πà‡∏≤‡∏á‡∏£‡∏≠ ‡∏´‡∏≤‡∏Å‡∏£‡∏π‡πâ‡∏™‡∏∂‡∏Å‡πÑ‡∏°‡πà‡∏õ‡∏•‡∏≠‡∏î‡∏†‡∏±‡∏¢\n‡∏Å‡∏£‡∏∏‡∏ì‡∏≤‡πÇ‡∏ó‡∏£ 1323 (‡∏ï‡∏•‡∏≠‡∏î 24 ‡∏ä‡∏°.)"
    },
    "footer": {
      "actions": [
        { "type": "uri", "label": "üìû ‡πÇ‡∏ó‡∏£ 1323 (‡∏™‡∏≤‡∏¢‡∏î‡πà‡∏ß‡∏ô‡∏™‡∏∏‡∏Ç‡∏†‡∏≤‡∏û‡∏à‡∏¥‡∏ï)", "uri": "tel:1323" },
        { "type": "uri", "label": "üìû ‡πÇ‡∏ó‡∏£‡∏â‡∏∏‡∏Å‡πÄ‡∏â‡∏¥‡∏ô‡∏°‡∏´‡∏≤‡∏ß‡∏¥‡∏ó‡∏¢‡∏≤‡∏•‡∏±‡∏¢", "uri": "tel:02-XXX-XXXX" },
        { "type": "postback", "label": "üíö ‡πÅ‡∏ö‡∏ö‡∏ù‡∏∂‡∏Å‡∏´‡∏±‡∏î‡∏ú‡πà‡∏≠‡∏ô‡∏Ñ‡∏•‡∏≤‡∏¢", "data": "action=safety_pack" }
      ]
    }
  }
}
```

---

## 3.5) Booking Soft Gate (‡πÅ‡∏ô‡∏∞‡∏ô‡∏≥‡∏õ‡∏£‡∏∞‡πÄ‡∏°‡∏¥‡∏ô‡∏Å‡πà‡∏≠‡∏ô‡∏ô‡∏±‡∏î ‚Äî ‡πÑ‡∏°‡πà‡∏ö‡∏±‡∏á‡∏Ñ‡∏±‡∏ö)

> **Design Rationale (‡∏´‡∏•‡∏±‡∏Å‡∏à‡∏¥‡∏ï‡∏ß‡∏¥‡∏ó‡∏¢‡∏≤‡∏Ñ‡∏•‡∏¥‡∏ô‡∏¥‡∏Å)**:  
> ‡∏ô‡∏®. ‡∏ó‡∏µ‡πà‡∏Å‡∏•‡πâ‡∏≤‡∏Å‡∏î "‡∏ô‡∏±‡∏î‡∏´‡∏°‡∏≤‡∏¢" ‡∏ú‡πà‡∏≤‡∏ô‡∏≠‡∏∏‡∏õ‡∏™‡∏£‡∏£‡∏Ñ‡∏ó‡∏≤‡∏á‡∏à‡∏¥‡∏ï‡πÉ‡∏à (stigma, ‡∏Ñ‡∏ß‡∏≤‡∏°‡∏Å‡∏•‡∏±‡∏ß) ‡∏°‡∏≤‡∏°‡∏≤‡∏Å‡πÅ‡∏•‡πâ‡∏ß  
> **‡∏´‡πâ‡∏≤‡∏°‡πÄ‡∏û‡∏¥‡πà‡∏° friction** ‡∏ó‡∏µ‡πà‡∏≠‡∏≤‡∏à‡∏ó‡∏≥‡πÉ‡∏´‡πâ‡∏ñ‡∏≠‡∏î‡πÉ‡∏à ‚Üí ‡πÉ‡∏ä‡πâ "Soft Gate" ‡πÅ‡∏ô‡∏∞‡∏ô‡∏≥‡πÅ‡∏ï‡πà‡πÑ‡∏°‡πà‡∏ö‡∏±‡∏á‡∏Ñ‡∏±‡∏ö  
> ‡∏ô‡∏±‡∏Å‡∏à‡∏¥‡∏ï‡∏ß‡∏¥‡∏ó‡∏¢‡∏≤‡∏™‡∏≤‡∏°‡∏≤‡∏£‡∏ñ‡∏ó‡∏≥ intake assessment ‡πÉ‡∏ô‡∏´‡πâ‡∏≠‡∏á‡πÑ‡∏î‡πâ ‡∏ñ‡πâ‡∏≤‡∏ô‡∏®. ‡πÑ‡∏°‡πà‡πÑ‡∏î‡πâ‡∏õ‡∏£‡∏∞‡πÄ‡∏°‡∏¥‡∏ô‡∏•‡πà‡∏ß‡∏á‡∏´‡∏ô‡πâ‡∏≤

### Entry Point

‡πÄ‡∏°‡∏∑‡πà‡∏≠ ‡∏ô‡∏®. ‡∏Å‡∏î Rich Menu "üìÖ ‡∏ô‡∏±‡∏î‡∏´‡∏°‡∏≤‡∏¢" ‡∏´‡∏£‡∏∑‡∏≠ postback `action=booking_gate`:

**‡∏Ç‡∏±‡πâ‡∏ô‡∏ï‡∏≠‡∏ô‡∏ó‡∏µ‡πà 1**: ‡∏ï‡∏£‡∏ß‡∏à‡∏™‡∏≠‡∏ö‡∏ß‡πà‡∏≤‡∏°‡∏µ‡∏ú‡∏•‡∏õ‡∏£‡∏∞‡πÄ‡∏°‡∏¥‡∏ô‡∏•‡πà‡∏≤‡∏™‡∏∏‡∏î‡∏´‡∏£‡∏∑‡∏≠‡πÑ‡∏°‡πà

```
Backend: GET latest screening ‡∏Ç‡∏≠‡∏á student

IF ‡∏°‡∏µ‡∏ú‡∏•‡∏õ‡∏£‡∏∞‡πÄ‡∏°‡∏¥‡∏ô‡∏†‡∏≤‡∏¢‡πÉ‡∏ô 30 ‡∏ß‡∏±‡∏ô:
  ‚Üí ‡∏Ç‡πâ‡∏≤‡∏°‡πÑ‡∏õ‡πÄ‡∏õ‡∏¥‡∏î LIFF Booking ‡∏ó‡∏±‡∏ô‡∏ó‡∏µ (‡πÑ‡∏°‡πà‡∏ï‡πâ‡∏≠‡∏á‡πÅ‡∏™‡∏î‡∏á Soft Gate)

IF ‡πÑ‡∏°‡πà‡∏°‡∏µ‡∏ú‡∏•‡∏õ‡∏£‡∏∞‡πÄ‡∏°‡∏¥‡∏ô ‡∏´‡∏£‡∏∑‡∏≠‡πÄ‡∏Å‡πà‡∏≤‡∏Å‡∏ß‡πà‡∏≤ 30 ‡∏ß‡∏±‡∏ô:
  ‚Üí ‡πÅ‡∏™‡∏î‡∏á Soft Gate Flex Message
```

**‡∏Ç‡∏±‡πâ‡∏ô‡∏ï‡∏≠‡∏ô‡∏ó‡∏µ‡πà 2**: Soft Gate Flex Message

```json
{
  "type": "flex",
  "altText": "‡πÅ‡∏ô‡∏∞‡∏ô‡∏≥: ‡∏õ‡∏£‡∏∞‡πÄ‡∏°‡∏¥‡∏ô‡πÄ‡∏ö‡∏∑‡πâ‡∏≠‡∏á‡∏ï‡πâ‡∏ô‡∏Å‡πà‡∏≠‡∏ô‡∏ô‡∏±‡∏î‡∏´‡∏°‡∏≤‡∏¢",
  "contents": {
    "type": "bubble",
    "header": {
      "type": "box", "layout": "vertical",
      "contents": [
        { "type": "text", "text": "üìã ‡πÅ‡∏ô‡∏∞‡∏ô‡∏≥‡∏Å‡πà‡∏≠‡∏ô‡∏ô‡∏±‡∏î‡∏´‡∏°‡∏≤‡∏¢", "weight": "bold", "size": "lg" }
      ]
    },
    "body": {
      "type": "box", "layout": "vertical",
      "contents": [
        { "type": "text", "text": "‡∏Å‡∏≤‡∏£‡∏ó‡∏≥‡πÅ‡∏ö‡∏ö‡∏õ‡∏£‡∏∞‡πÄ‡∏°‡∏¥‡∏ô‡πÄ‡∏ö‡∏∑‡πâ‡∏≠‡∏á‡∏ï‡πâ‡∏ô\n‡∏à‡∏∞‡∏ä‡πà‡∏ß‡∏¢‡πÉ‡∏´‡πâ‡πÄ‡∏£‡∏≤‡πÄ‡∏ï‡∏£‡∏µ‡∏¢‡∏°‡∏Å‡∏≤‡∏£‡∏ä‡πà‡∏ß‡∏¢‡πÄ‡∏´‡∏•‡∏∑‡∏≠\n‡πÑ‡∏î‡πâ‡∏ï‡∏£‡∏á‡∏à‡∏∏‡∏î‡∏°‡∏≤‡∏Å‡∏Ç‡∏∂‡πâ‡∏ô", "wrap": true },
        { "type": "text", "text": "‚è± ‡πÉ‡∏ä‡πâ‡πÄ‡∏ß‡∏•‡∏≤‡πÄ‡∏û‡∏µ‡∏¢‡∏á 2 ‡∏ô‡∏≤‡∏ó‡∏µ", "margin": "md", "color": "#888888" },
        { "type": "text", "text": "üîí ‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡πÄ‡∏õ‡πá‡∏ô‡∏Ñ‡∏ß‡∏≤‡∏°‡∏•‡∏±‡∏ö", "color": "#888888" }
      ]
    },
    "footer": {
      "type": "box", "layout": "vertical", "spacing": "sm",
      "contents": [
        {
          "type": "button", "style": "primary", "color": "#4CAF50",
          "action": { "type": "uri", "label": "üß† ‡∏õ‡∏£‡∏∞‡πÄ‡∏°‡∏¥‡∏ô‡∏Å‡πà‡∏≠‡∏ô‡∏ô‡∏±‡∏î (‡πÅ‡∏ô‡∏∞‡∏ô‡∏≥)", "uri": "https://liff.line.me/{LIFF_SCREENING_ID}?next=booking" }
        },
        {
          "type": "button", "style": "link",
          "action": { "type": "uri", "label": "üìÖ ‡∏Ç‡πâ‡∏≤‡∏°‡πÑ‡∏õ‡∏ô‡∏±‡∏î‡∏´‡∏°‡∏≤‡∏¢‡πÄ‡∏•‡∏¢", "uri": "https://liff.line.me/{LIFF_BOOKING_ID}" }
        }
      ]
    }
  }
}
```

### Screening ‚Üí Booking Redirect

```
‡∏ñ‡πâ‡∏≤ LIFF Screening ‡πÄ‡∏õ‡∏¥‡∏î‡∏î‡πâ‡∏ß‡∏¢ ?next=booking:
  ‚Üí ‡∏´‡∏•‡∏±‡∏á‡∏™‡πà‡∏á‡∏ú‡∏•‡∏õ‡∏£‡∏∞‡πÄ‡∏°‡∏¥‡∏ô‡πÄ‡∏™‡∏£‡πá‡∏à
  ‚Üí ‡πÅ‡∏™‡∏î‡∏á‡∏õ‡∏∏‡πà‡∏° "üìÖ ‡πÑ‡∏õ‡∏ô‡∏±‡∏î‡∏´‡∏°‡∏≤‡∏¢‡∏ï‡πà‡∏≠" ‡πÉ‡∏ô LIFF (‡πÑ‡∏°‡πà‡∏ï‡πâ‡∏≠‡∏á‡∏õ‡∏¥‡∏î‡πÅ‡∏•‡πâ‡∏ß‡πÄ‡∏õ‡∏¥‡∏î‡πÉ‡∏´‡∏°‡πà)
  ‚Üí ‡∏´‡∏£‡∏∑‡∏≠ Bot push Flex Message ‡∏ú‡∏•‡∏õ‡∏£‡∏∞‡πÄ‡∏°‡∏¥‡∏ô + ‡∏õ‡∏∏‡πà‡∏° "üìÖ ‡∏ô‡∏±‡∏î‡∏´‡∏°‡∏≤‡∏¢‡πÄ‡∏•‡∏¢"
```

---

## 4) Booking Flow (LIFF)

> **Entry Points**: ‡∏à‡∏≤‡∏Å‡∏ú‡∏•‡∏õ‡∏£‡∏∞‡πÄ‡∏°‡∏¥‡∏ô (CTA), ‡∏à‡∏≤‡∏Å Soft Gate ("‡∏Ç‡πâ‡∏≤‡∏°‡πÑ‡∏õ‡∏ô‡∏±‡∏î‡∏´‡∏°‡∏≤‡∏¢"), ‡∏´‡∏£‡∏∑‡∏≠‡∏à‡∏≤‡∏Å Screening ‡∏ó‡∏µ‡πà‡∏°‡∏µ `?next=booking`

### 4.1 LIFF Booking UI

```
               LIFF App (Booking)
‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê
‚îÇ                                         ‚îÇ
‚îÇ   üìÖ ‡∏ô‡∏±‡∏î‡∏´‡∏°‡∏≤‡∏¢                            ‚îÇ
‚îÇ                                         ‚îÇ
‚îÇ   ‡∏õ‡∏£‡∏∞‡πÄ‡∏†‡∏ó: ‚óã ‡∏≠‡∏≤‡∏à‡∏≤‡∏£‡∏¢‡πå‡∏ó‡∏µ‡πà‡∏õ‡∏£‡∏∂‡∏Å‡∏©‡∏≤            ‚îÇ
‚îÇ           ‚óè ‡∏ô‡∏±‡∏Å‡∏à‡∏¥‡∏ï‡∏ß‡∏¥‡∏ó‡∏¢‡∏≤                  ‚îÇ
‚îÇ                                         ‚îÇ
‚îÇ   ‡∏£‡∏π‡∏õ‡πÅ‡∏ö‡∏ö: ‚óã ‡∏°‡∏≤‡∏û‡∏ö‡∏ï‡∏±‡∏ß (onsite)            ‚îÇ
‚îÇ           ‚óè ‡∏≠‡∏≠‡∏ô‡πÑ‡∏•‡∏ô‡πå (online)             ‚îÇ
‚îÇ                                         ‚îÇ
‚îÇ   ‚îÄ‚îÄ ‡∏ß‡∏±‡∏ô‡∏ó‡∏µ‡πà‡∏ß‡πà‡∏≤‡∏á ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ       ‚îÇ
‚îÇ   üìÜ ‡∏à. 3 ‡∏°‡∏µ.‡∏Ñ. 2026                    ‚îÇ
‚îÇ      [ 09:00-09:30 ] [ 10:00-10:30 ]    ‚îÇ
‚îÇ      [ 13:00-13:30 ] [ 14:00-14:30 ]    ‚îÇ
‚îÇ                                         ‚îÇ
‚îÇ   üìÜ ‡∏≠. 4 ‡∏°‡∏µ.‡∏Ñ. 2026                    ‚îÇ
‚îÇ      [ 09:00-09:30 ] [ 11:00-11:30 ]    ‚îÇ
‚îÇ                                         ‚îÇ
‚îÇ         [ ‚úÖ ‡∏¢‡∏∑‡∏ô‡∏¢‡∏±‡∏ô‡∏ô‡∏±‡∏î‡∏´‡∏°‡∏≤‡∏¢ ]             ‚îÇ
‚îÇ                                         ‚îÇ
‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò
```

### 4.2 Booking API Flow

```
1) LIFF ‚Üí GET /advisory/slots?from=...&to=...
   ‡∏´‡∏£‡∏∑‡∏≠  GET /clinical/slots?from=...&to=...
   ‚Üí ‡πÅ‡∏™‡∏î‡∏á slots ‡∏ó‡∏µ‡πà is_available = true

2) ‡∏ô‡∏®. ‡πÄ‡∏•‡∏∑‡∏≠‡∏Å slot ‚Üí LIFF ‚Üí POST /appointments
   {
     "student_id": "uuid",
     "type": "counselor",
     "slot_id": "uuid",
     "mode": "onsite"
   }

3) Response ‚Üí ‡∏õ‡∏¥‡∏î LIFF ‚Üí Bot push ‡∏¢‡∏∑‡∏ô‡∏¢‡∏±‡∏ô
```

### 4.3 Booking Confirmation Message (Bot Push)

```json
{
  "type": "flex",
  "altText": "‡∏¢‡∏∑‡∏ô‡∏¢‡∏±‡∏ô‡∏ô‡∏±‡∏î‡∏´‡∏°‡∏≤‡∏¢‡∏™‡∏≥‡πÄ‡∏£‡πá‡∏à",
  "contents": {
    "type": "bubble",
    "header": { "text": "‚úÖ ‡∏ô‡∏±‡∏î‡∏´‡∏°‡∏≤‡∏¢‡∏™‡∏≥‡πÄ‡∏£‡πá‡∏à" },
    "body": {
      "contents": [
        { "type": "text", "text": "üìÖ ‡∏à. 3 ‡∏°‡∏µ.‡∏Ñ. 2026" },
        { "type": "text", "text": "üïê 09:00 - 09:30" },
        { "type": "text", "text": "üìç ‡∏´‡πâ‡∏≠‡∏á‡πÉ‡∏´‡πâ‡∏Ñ‡∏≥‡∏õ‡∏£‡∏∂‡∏Å‡∏©‡∏≤ ‡∏≠‡∏≤‡∏Ñ‡∏≤‡∏£ X ‡∏ä‡∏±‡πâ‡∏ô 3" },
        { "type": "text", "text": "üîí ‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡πÄ‡∏õ‡πá‡∏ô‡∏Ñ‡∏ß‡∏≤‡∏°‡∏•‡∏±‡∏ö" }
      ]
    },
    "footer": {
      "actions": [
        { "type": "postback", "label": "üìã ‡∏î‡∏π‡∏ô‡∏±‡∏î‡∏´‡∏°‡∏≤‡∏¢‡∏Ç‡∏≠‡∏á‡∏â‡∏±‡∏ô", "data": "action=my_appointments" },
        { "type": "postback", "label": "‚ùå ‡∏¢‡∏Å‡πÄ‡∏•‡∏¥‡∏Å‡∏ô‡∏±‡∏î‡∏´‡∏°‡∏≤‡∏¢", "data": "action=cancel_appt&id=uuid" }
      ]
    }
  }
}
```

### 4.4 Reminder Messages (DB Jobs)

| ‡πÄ‡∏°‡∏∑‡πà‡∏≠‡πÑ‡∏´‡∏£‡πà | Job Type | ‡∏Ç‡πâ‡∏≠‡∏Ñ‡∏ß‡∏≤‡∏° |
|----------|----------|---------|
| 1 ‡∏ß‡∏±‡∏ô‡∏Å‡πà‡∏≠‡∏ô | `reminder_1d` | "‡∏û‡∏£‡∏∏‡πà‡∏á‡∏ô‡∏µ‡πâ‡∏Ñ‡∏∏‡∏ì‡∏°‡∏µ‡∏ô‡∏±‡∏î‡∏û‡∏ö... ‡πÄ‡∏ß‡∏•‡∏≤... üìç..." |
| 2 ‡∏ä‡∏±‡πà‡∏ß‡πÇ‡∏°‡∏á‡∏Å‡πà‡∏≠‡∏ô | `reminder_2h` | "‡∏≠‡∏µ‡∏Å 2 ‡∏ä‡∏±‡πà‡∏ß‡πÇ‡∏°‡∏á ‡∏Ñ‡∏∏‡∏ì‡∏°‡∏µ‡∏ô‡∏±‡∏î‡∏û‡∏ö..." |
| ‡∏ñ‡πâ‡∏≤ no_show | `follow_up_noshow` | "‡πÄ‡∏£‡∏≤‡∏™‡∏±‡∏á‡πÄ‡∏Å‡∏ï‡∏ß‡πà‡∏≤‡∏Ñ‡∏∏‡∏ì‡πÑ‡∏°‡πà‡πÑ‡∏î‡πâ‡∏°‡∏≤‡∏ï‡∏≤‡∏°‡∏ô‡∏±‡∏î ‡πÑ‡∏°‡πà‡πÄ‡∏õ‡πá‡∏ô‡πÑ‡∏£ ‡∏Ñ‡∏∏‡∏ì‡∏™‡∏≤‡∏°‡∏≤‡∏£‡∏ñ‡∏à‡∏≠‡∏á‡πÉ‡∏´‡∏°‡πà‡πÑ‡∏î‡πâ‡πÄ‡∏•‡∏¢ üíõ" |

---

## 5) Postback Payload Schema

### Standard Format

```
action={action_name}&{param1}={value1}&{param2}={value2}
```

### Postback Registry

| Postback Data | Handler | Response |
|---------------|---------|----------|
| `action=booking_gate` | BookingGateHandler | ‡∏ï‡∏£‡∏ß‡∏à screening ‡∏•‡πà‡∏≤‡∏™‡∏∏‡∏î ‚Üí Soft Gate ‡∏´‡∏£‡∏∑‡∏≠‡πÄ‡∏õ‡∏¥‡∏î LIFF Booking |
| `action=resources` | ResourceHandler | Flex Carousel ‡∏Ç‡∏≠‡∏á self-help resources |
| `action=resources&category=stress` | ResourceHandler | Resources filtered by category |
| `action=book&type=advisor` | BookingHandler | ‡πÄ‡∏õ‡∏¥‡∏î LIFF Booking (advisor) |
| `action=book&type=counselor` | BookingHandler | ‡πÄ‡∏õ‡∏¥‡∏î LIFF Booking (counselor) |
| `action=my_appointments` | AppointmentHandler | Flex Message ‡∏£‡∏≤‡∏¢‡∏Å‡∏≤‡∏£‡∏ô‡∏±‡∏î‡∏´‡∏°‡∏≤‡∏¢ |
| `action=cancel_appt&id={uuid}` | AppointmentHandler | ‡∏¢‡∏∑‡∏ô‡∏¢‡∏±‡∏ô ‚Üí ‡∏¢‡∏Å‡πÄ‡∏•‡∏¥‡∏Å |
| `action=safety_pack` | SafetyHandler | Safety Pack: ‡πÄ‡∏ö‡∏≠‡∏£‡πå‡∏â‡∏∏‡∏Å‡πÄ‡∏â‡∏¥‡∏ô + ‡πÅ‡∏ö‡∏ö‡∏ù‡∏∂‡∏Å‡∏•‡∏î‡πÄ‡∏Ñ‡∏£‡∏µ‡∏¢‡∏î |
| `action=emergency_info` | SafetyHandler | ‡πÄ‡∏ö‡∏≠‡∏£‡πå‡∏â‡∏∏‡∏Å‡πÄ‡∏â‡∏¥‡∏ô‡∏ó‡∏±‡πâ‡∏á‡∏´‡∏°‡∏î |
| `action=my_screenings` | ScreeningHandler | Flex Message ‡∏õ‡∏£‡∏∞‡∏ß‡∏±‡∏ï‡∏¥‡∏ú‡∏•‡∏õ‡∏£‡∏∞‡πÄ‡∏°‡∏¥‡∏ô |

---

## 6) Webhook Event Handling

### 6.1 Event Router

```
POST /webhooks/line
  ‚îú‚îÄ‚îÄ Verify x-line-signature
  ‚îú‚îÄ‚îÄ Deduplicate (eventId ‚Üí public.line_event_dedupe)
  ‚îî‚îÄ‚îÄ Route by event type:
      ‚îú‚îÄ‚îÄ follow    ‚Üí FollowHandler
      ‚îú‚îÄ‚îÄ unfollow  ‚Üí UnfollowHandler
      ‚îú‚îÄ‚îÄ message   ‚Üí MessageHandler
      ‚îÇ   ‚îî‚îÄ‚îÄ text  ‚Üí TextRouter
      ‚îî‚îÄ‚îÄ postback  ‚Üí PostbackRouter
```

### 6.2 Text Router (Keyword Matching)

| ‡∏Ç‡πâ‡∏≠‡∏Ñ‡∏ß‡∏≤‡∏° (Thai) | ‡∏Ç‡πâ‡∏≠‡∏Ñ‡∏ß‡∏≤‡∏° (English) | Action |
|---------------|------------------|--------|
| ‡πÄ‡∏£‡∏¥‡πà‡∏°‡∏ï‡πâ‡∏ô / ‡∏¢‡∏∑‡∏ô‡∏¢‡∏±‡∏ô‡∏ï‡∏±‡∏ß‡∏ï‡∏ô / ‡∏•‡∏á‡∏ó‡∏∞‡πÄ‡∏ö‡∏µ‡∏¢‡∏ô | start / register | ‡πÄ‡∏õ‡∏¥‡∏î LIFF Verify |
| ‡∏õ‡∏£‡∏∞‡πÄ‡∏°‡∏¥‡∏ô / ‡∏õ‡∏£‡∏∞‡πÄ‡∏°‡∏¥‡∏ô‡∏Ñ‡∏ß‡∏≤‡∏°‡πÄ‡∏Ñ‡∏£‡∏µ‡∏¢‡∏î / ‡πÄ‡∏ä‡πá‡∏Ñ‡∏™‡∏∏‡∏Ç‡∏†‡∏≤‡∏û‡∏à‡∏¥‡∏ï | screen / assess | ‡πÄ‡∏õ‡∏¥‡∏î LIFF Screening |
| ‡∏ô‡∏±‡∏î‡∏´‡∏°‡∏≤‡∏¢ / ‡∏à‡∏≠‡∏á‡∏Ñ‡∏¥‡∏ß / ‡∏û‡∏ö‡∏ô‡∏±‡∏Å‡∏à‡∏¥‡∏ï‡∏ß‡∏¥‡∏ó‡∏¢‡∏≤ | book / appointment | ‡πÄ‡∏õ‡∏¥‡∏î LIFF Booking |
| ‡∏ä‡πà‡∏ß‡∏¢‡πÄ‡∏´‡∏•‡∏∑‡∏≠ / ‡∏â‡∏∏‡∏Å‡πÄ‡∏â‡∏¥‡∏ô / SOS | help / emergency | Safety Pack message |
| ‡πÄ‡∏°‡∏ô‡∏π / menu | menu | ‡πÅ‡∏™‡∏î‡∏á Quick Reply Menu |

### 6.3 Follow Event Handler

```javascript
async function handleFollow(event) {
  const userId = event.source.userId;
  
  // 1) Check if already linked
  const student = await db.findByLineUserId(userId);
  
  if (student) {
    // Already linked ‚Üí assign Verified rich menu
    await lineClient.linkRichMenuToUser(userId, VERIFIED_MENU_ID);
    await lineClient.pushMessage(userId, welcomeBackMessage(student));
  } else {
    // Not linked ‚Üí assign Guest rich menu + welcome message
    await lineClient.linkRichMenuToUser(userId, GUEST_MENU_ID);
    await lineClient.pushMessage(userId, welcomeNewMessage());
  }
}
```

---

## 7) Message Templates

### 7.1 Welcome (New User ‚Äî ‡∏¢‡∏±‡∏á‡πÑ‡∏°‡πà‡∏¢‡∏∑‡∏ô‡∏¢‡∏±‡∏ô)

```
‡∏™‡∏ß‡∏±‡∏™‡∏î‡∏µ! üëã ‡∏¢‡∏¥‡∏ô‡∏î‡∏µ‡∏ï‡πâ‡∏≠‡∏ô‡∏£‡∏±‡∏ö‡∏™‡∏π‡πà‡∏£‡∏∞‡∏ö‡∏ö‡∏î‡∏π‡πÅ‡∏•‡∏™‡∏∏‡∏Ç‡∏†‡∏≤‡∏û‡∏à‡∏¥‡∏ï‡∏ô‡∏±‡∏Å‡∏®‡∏∂‡∏Å‡∏©‡∏≤
‡∏°‡∏´‡∏≤‡∏ß‡∏¥‡∏ó‡∏¢‡∏≤‡∏•‡∏±‡∏¢‡∏ô‡∏≠‡∏£‡πå‡∏ó‡∏Å‡∏£‡∏∏‡∏á‡πÄ‡∏ó‡∏û

üîí ‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏ó‡∏∏‡∏Å‡∏≠‡∏¢‡πà‡∏≤‡∏á‡πÄ‡∏õ‡πá‡∏ô‡∏Ñ‡∏ß‡∏≤‡∏°‡∏•‡∏±‡∏ö
‡∏≠‡∏≤‡∏à‡∏≤‡∏£‡∏¢‡πå‡∏´‡∏£‡∏∑‡∏≠‡∏ú‡∏π‡πâ‡∏õ‡∏Å‡∏Ñ‡∏£‡∏≠‡∏á‡∏à‡∏∞‡πÑ‡∏°‡πà‡πÄ‡∏´‡πá‡∏ô‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏Ç‡∏≠‡∏á‡∏Ñ‡∏∏‡∏ì

‡πÄ‡∏û‡∏∑‡πà‡∏≠‡πÄ‡∏£‡∏¥‡πà‡∏°‡∏ï‡πâ‡∏ô‡πÉ‡∏ä‡πâ‡∏á‡∏≤‡∏ô ‡∏Å‡∏£‡∏∏‡∏ì‡∏≤‡∏¢‡∏∑‡∏ô‡∏¢‡∏±‡∏ô‡∏ï‡∏±‡∏ß‡∏ï‡∏ô‡∏Å‡πà‡∏≠‡∏ô‡∏ô‡∏∞
üëá ‡∏Å‡∏î‡∏õ‡∏∏‡πà‡∏°‡∏î‡πâ‡∏≤‡∏ô‡∏•‡πà‡∏≤‡∏á

[üîê ‡∏¢‡∏∑‡∏ô‡∏¢‡∏±‡∏ô‡∏ï‡∏±‡∏ß‡∏ï‡∏ô] ‚Üê Quick Reply
```

### 7.2 Welcome Back (User ‡∏ó‡∏µ‡πà linked ‡πÅ‡∏•‡πâ‡∏ß)

```
‡∏™‡∏ß‡∏±‡∏™‡∏î‡∏µ‡∏≠‡∏µ‡∏Å‡∏Ñ‡∏£‡∏±‡πâ‡∏á! üòä
‡∏¢‡∏¥‡∏ô‡∏î‡∏µ‡∏ó‡∏µ‡πà‡πÑ‡∏î‡πâ‡∏û‡∏ö‡∏Ñ‡∏∏‡∏ì‡∏≠‡∏µ‡∏Å

‡∏Ñ‡∏∏‡∏ì‡∏™‡∏≤‡∏°‡∏≤‡∏£‡∏ñ‡πÉ‡∏ä‡πâ‡πÄ‡∏°‡∏ô‡∏π‡∏î‡πâ‡∏≤‡∏ô‡∏•‡πà‡∏≤‡∏á‡πÑ‡∏î‡πâ‡πÄ‡∏•‡∏¢
‡∏´‡∏£‡∏∑‡∏≠‡∏û‡∏¥‡∏°‡∏û‡πå "‡∏ä‡πà‡∏ß‡∏¢‡πÄ‡∏´‡∏•‡∏∑‡∏≠" ‡πÑ‡∏î‡πâ‡∏ï‡∏•‡∏≠‡∏î‡πÄ‡∏ß‡∏•‡∏≤ üíõ
```

### 7.3 Safety Pack (Crisis/Emergency)

```
‚ù§Ô∏è ‡∏Ñ‡∏ß‡∏≤‡∏°‡∏ä‡πà‡∏ß‡∏¢‡πÄ‡∏´‡∏•‡∏∑‡∏≠‡∏û‡∏£‡πâ‡∏≠‡∏°‡∏≠‡∏¢‡∏π‡πà‡πÄ‡∏™‡∏°‡∏≠

üìû ‡∏™‡∏≤‡∏¢‡∏î‡πà‡∏ß‡∏ô‡∏™‡∏∏‡∏Ç‡∏†‡∏≤‡∏û‡∏à‡∏¥‡∏ï: 1323 (24 ‡∏ä‡∏°.)
üìû ‡∏™‡∏≤‡∏¢‡∏î‡πà‡∏ß‡∏ô‡∏â‡∏∏‡∏Å‡πÄ‡∏â‡∏¥‡∏ô: 1669
üìû ‡∏ù‡πà‡∏≤‡∏¢‡∏î‡∏π‡πÅ‡∏•‡∏ô‡∏±‡∏Å‡∏®‡∏∂‡∏Å‡∏©‡∏≤: 02-XXX-XXXX

üíö ‡∏£‡∏∞‡∏´‡∏ß‡πà‡∏≤‡∏á‡∏£‡∏≠ ‡∏•‡∏≠‡∏á‡∏ó‡∏≥‡πÅ‡∏ö‡∏ö‡∏ù‡∏∂‡∏Å‡∏´‡∏±‡∏î‡∏ô‡∏µ‡πâ:
‚Ä¢ ‡∏´‡∏≤‡∏¢‡πÉ‡∏à‡πÄ‡∏Ç‡πâ‡∏≤‡∏•‡∏∂‡∏Å‡πÜ 4 ‡∏ß‡∏¥‡∏ô‡∏≤‡∏ó‡∏µ
‚Ä¢ ‡∏Å‡∏•‡∏±‡πâ‡∏ô‡∏´‡∏≤‡∏¢‡πÉ‡∏à 7 ‡∏ß‡∏¥‡∏ô‡∏≤‡∏ó‡∏µ
‚Ä¢ ‡∏´‡∏≤‡∏¢‡πÉ‡∏à‡∏≠‡∏≠‡∏Å‡∏ä‡πâ‡∏≤‡πÜ 8 ‡∏ß‡∏¥‡∏ô‡∏≤‡∏ó‡∏µ
(‡∏ó‡∏≥ 3-4 ‡∏£‡∏≠‡∏ö)

‡∏Ñ‡∏∏‡∏ì‡πÑ‡∏°‡πà‡πÑ‡∏î‡πâ‡∏≠‡∏¢‡∏π‡πà‡∏Ñ‡∏ô‡πÄ‡∏î‡∏µ‡∏¢‡∏ß ü§ù
```

### 7.4 Consent Prompt (‡∏Å‡πà‡∏≠‡∏ô‡∏ó‡∏≥‡πÅ‡∏ö‡∏ö‡∏õ‡∏£‡∏∞‡πÄ‡∏°‡∏¥‡∏ô)

```
üìã ‡∏Å‡πà‡∏≠‡∏ô‡πÄ‡∏£‡∏¥‡πà‡∏°‡∏õ‡∏£‡∏∞‡πÄ‡∏°‡∏¥‡∏ô

‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏Ç‡∏≠‡∏á‡∏Ñ‡∏∏‡∏ì‡∏à‡∏∞‡∏ñ‡∏π‡∏Å‡πÄ‡∏Å‡πá‡∏ö‡πÄ‡∏õ‡πá‡∏ô‡∏Ñ‡∏ß‡∏≤‡∏°‡∏•‡∏±‡∏ö
‡πÄ‡∏â‡∏û‡∏≤‡∏∞‡∏ô‡∏±‡∏Å‡∏à‡∏¥‡∏ï‡∏ß‡∏¥‡∏ó‡∏¢‡∏≤‡∏Ç‡∏≠‡∏á‡∏°‡∏´‡∏≤‡∏ß‡∏¥‡∏ó‡∏¢‡∏≤‡∏•‡∏±‡∏¢‡πÄ‡∏ó‡πà‡∏≤‡∏ô‡∏±‡πâ‡∏ô
‡∏ó‡∏µ‡πà‡∏à‡∏∞‡πÄ‡∏´‡πá‡∏ô‡∏ú‡∏•‡∏õ‡∏£‡∏∞‡πÄ‡∏°‡∏¥‡∏ô

‚úÖ ‡∏≠‡∏≤‡∏à‡∏≤‡∏£‡∏¢‡πå‡∏ó‡∏µ‡πà‡∏õ‡∏£‡∏∂‡∏Å‡∏©‡∏≤/‡∏ú‡∏π‡πâ‡∏õ‡∏Å‡∏Ñ‡∏£‡∏≠‡∏á ‡∏à‡∏∞‡πÑ‡∏°‡πà‡πÄ‡∏´‡πá‡∏ô‡∏ú‡∏•
‚úÖ ‡∏ú‡∏•‡∏à‡∏∞‡πÑ‡∏°‡πà‡∏Å‡∏£‡∏∞‡∏ó‡∏ö‡∏ú‡∏•‡∏Å‡∏≤‡∏£‡πÄ‡∏£‡∏µ‡∏¢‡∏ô
‚úÖ ‡∏Ñ‡∏∏‡∏ì‡∏ñ‡∏≠‡∏ô‡∏Ñ‡∏ß‡∏≤‡∏°‡∏¢‡∏¥‡∏ô‡∏¢‡∏≠‡∏°‡πÑ‡∏î‡πâ‡∏ï‡∏•‡∏≠‡∏î‡πÄ‡∏ß‡∏•‡∏≤

(‡∏≠‡πà‡∏≤‡∏ô‡∏ô‡πÇ‡∏¢‡∏ö‡∏≤‡∏¢‡∏Ñ‡∏ß‡∏≤‡∏°‡πÄ‡∏õ‡πá‡∏ô‡∏™‡πà‡∏ß‡∏ô‡∏ï‡∏±‡∏ß‡∏â‡∏ö‡∏±‡∏ö‡πÄ‡∏ï‡πá‡∏°)
```

---

## 8) Notification to Staff (via LINE Messaging API Push)

> ‚ö†Ô∏è **LINE Notify ‡πÄ‡∏•‡∏¥‡∏Å‡πÉ‡∏´‡πâ‡∏ö‡∏£‡∏¥‡∏Å‡∏≤‡∏£‡πÅ‡∏•‡πâ‡∏ß** ‚Äî ‡πÉ‡∏ä‡πâ LINE Messaging API push message ‡πÅ‡∏ó‡∏ô  
> Staff (counselor/supervisor) ‡∏ï‡πâ‡∏≠‡∏á‡πÄ‡∏û‡∏¥‡πà‡∏°‡πÄ‡∏û‡∏∑‡πà‡∏≠‡∏ô LINE OA ‡πÄ‡∏û‡∏∑‡πà‡∏≠‡∏£‡∏±‡∏ö notification  
> Backend ‡∏£‡∏∞‡∏ö‡∏∏ staff ‡∏ú‡πà‡∏≤‡∏ô‡∏ï‡∏≤‡∏£‡∏≤‡∏á line_links (staff ‡∏°‡∏µ user_id ‡∏ó‡∏µ‡πà‡∏ú‡∏π‡∏Å‡∏Å‡∏±‡∏ö line_user_id)

> **‡∏Å‡∏é‡πÄ‡∏´‡∏•‡πá‡∏Å**: ‡∏´‡πâ‡∏≤‡∏°‡∏™‡πà‡∏á‡∏Ñ‡∏∞‡πÅ‡∏ô‡∏ô/‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏• clinical ‡∏ú‡πà‡∏≤‡∏ô LINE notification  
> ‡∏™‡πà‡∏á‡πÄ‡∏â‡∏û‡∏≤‡∏∞: case_id + priority + link ‡πÑ‡∏õ‡∏¢‡∏±‡∏á dashboard (‡∏ï‡πâ‡∏≠‡∏á login)

### 8.1 Counselor Notification (Case Created)

```
üîî ‡πÅ‡∏à‡πâ‡∏á‡πÄ‡∏ï‡∏∑‡∏≠‡∏ô‡πÄ‡∏Ñ‡∏™‡πÉ‡∏´‡∏°‡πà

Priority: üî¥ CRISIS
Case ID: #C-2026-0042
Action: ‡∏Å‡∏£‡∏∏‡∏ì‡∏≤‡∏ï‡∏£‡∏ß‡∏à‡∏™‡∏≠‡∏ö‡∏†‡∏≤‡∏¢‡πÉ‡∏ô 30 ‡∏ô‡∏≤‡∏ó‡∏µ

[üîó ‡πÄ‡∏õ‡∏¥‡∏î Dashboard] ‚Üí https://admin.domain/clinical/cases/uuid
(‡∏ï‡πâ‡∏≠‡∏á login ‡πÄ‡∏û‡∏∑‡πà‡∏≠‡∏î‡∏π‡∏£‡∏≤‡∏¢‡∏•‡∏∞‡πÄ‡∏≠‡∏µ‡∏¢‡∏î)
```

### 8.2 Escalation Alert (30 min timeout ‚Äî Crisis)

```
‚ö†Ô∏è Escalation Alert

Case #C-2026-0042 ‡∏¢‡∏±‡∏á‡πÑ‡∏°‡πà‡∏ñ‡∏π‡∏Å ACK ‡∏†‡∏≤‡∏¢‡πÉ‡∏ô 30 ‡∏ô‡∏≤‡∏ó‡∏µ
Priority: üî¥ CRISIS

‡∏Å‡∏£‡∏∏‡∏ì‡∏≤‡∏î‡∏≥‡πÄ‡∏ô‡∏¥‡∏ô‡∏Å‡∏≤‡∏£‡∏ó‡∏±‡∏ô‡∏ó‡∏µ
[üîó ‡πÄ‡∏õ‡∏¥‡∏î Dashboard]
```

---

## 9) Privacy Safeguards (LINE-specific)

| Rule | Implementation |
|------|---------------|
| ‡∏´‡πâ‡∏≤‡∏°‡∏™‡πà‡∏á raw score ‡∏ú‡πà‡∏≤‡∏ô LINE | Bot ‡∏™‡πà‡∏á‡πÄ‡∏â‡∏û‡∏≤‡∏∞ risk level ‡πÉ‡∏ô‡∏†‡∏≤‡∏©‡∏≤‡∏ó‡∏µ‡πà‡πÄ‡∏Ç‡πâ‡∏≤‡πÉ‡∏à‡∏á‡πà‡∏≤‡∏¢ |
| ‡∏´‡πâ‡∏≤‡∏°‡∏™‡πà‡∏á student info ‡πÉ‡∏´‡πâ staff ‡∏ú‡πà‡∏≤‡∏ô LINE | ‡∏™‡πà‡∏á‡πÄ‡∏â‡∏û‡∏≤‡∏∞ case_id + link to dashboard |
| Chat history ‡πÑ‡∏°‡πà‡∏Ñ‡∏ß‡∏£‡∏°‡∏µ sensitive data | Screening ‡∏ó‡∏≥‡∏ú‡πà‡∏≤‡∏ô LIFF (‡πÅ‡∏¢‡∏Å context) |
| ‡∏¢‡∏∑‡∏ô‡∏¢‡∏±‡∏ô‡∏ï‡∏±‡∏ß‡∏ï‡∏ô‡∏ú‡πà‡∏≤‡∏ô LIFF | DOB + ‡πÄ‡∏•‡∏Ç‡∏ö‡∏±‡∏ï‡∏£/Passport ‡πÑ‡∏°‡πà‡∏ú‡πà‡∏≤‡∏ô LINE chat (‡πÑ‡∏°‡πà‡πÄ‡∏Å‡πá‡∏ö‡πÉ‡∏ô chat log) |
| ‡πÄ‡∏Å‡πá‡∏ö‡πÄ‡∏•‡∏Ç‡∏ö‡∏±‡∏ï‡∏£/passport ‡πÄ‡∏õ‡πá‡∏ô hash ‡πÄ‡∏ó‡πà‡∏≤‡∏ô‡∏±‡πâ‡∏ô | SHA-256 + salt, ‡πÑ‡∏°‡πà‡πÄ‡∏Å‡πá‡∏ö plain text |
| Consent tracking | ‡∏ö‡∏±‡∏ô‡∏ó‡∏∂‡∏Å version + timestamp ‡∏ó‡∏∏‡∏Å‡∏Ñ‡∏£‡∏±‡πâ‡∏á‡∏ó‡∏µ‡πà‡∏¢‡∏¥‡∏ô‡∏¢‡∏≠‡∏° |

---

## 10) LIFF App Endpoints Summary

| LIFF App | LIFF ID ‡∏ï‡∏±‡∏ß‡πÅ‡∏õ‡∏£ | ‡∏´‡∏ô‡πâ‡∏≤‡∏ó‡∏µ‡πà | ‡πÄ‡∏£‡∏µ‡∏¢‡∏Å API |
|----------|---------------|---------|----------|
| Verify | `LIFF_VERIFY_ID` | ‡∏¢‡∏∑‡∏ô‡∏¢‡∏±‡∏ô‡∏ï‡∏±‡∏ß‡∏ï‡∏ô ‡∏ô‡∏®. | `POST /students/link-line` |
| Screening | `LIFF_SCREENING_ID` | ‡∏ó‡∏≥‡πÅ‡∏ö‡∏ö‡∏õ‡∏£‡∏∞‡πÄ‡∏°‡∏¥‡∏ô | `POST /screenings` |
| Booking | `LIFF_BOOKING_ID` | ‡∏à‡∏≠‡∏á‡∏ô‡∏±‡∏î‡∏´‡∏°‡∏≤‡∏¢ | `GET /*/slots` ‚Üí `POST /appointments` |

> LIFF apps ‡∏≠‡∏≤‡∏à‡πÄ‡∏õ‡πá‡∏ô Single LIFF App ‡∏ó‡∏µ‡πà route ‡∏†‡∏≤‡∏¢‡πÉ‡∏ô (Next.js/React SPA)  
> ‡∏´‡∏£‡∏∑‡∏≠‡πÅ‡∏¢‡∏Å 3 LIFF IDs ‡∏Å‡πá‡πÑ‡∏î‡πâ ‡∏Ç‡∏∂‡πâ‡∏ô‡∏Å‡∏±‡∏ö‡∏Ñ‡∏ß‡∏≤‡∏°‡∏ï‡πâ‡∏≠‡∏á‡∏Å‡∏≤‡∏£

---

## 11) Error & Edge Case Handling

| ‡∏Å‡∏£‡∏ì‡∏µ | Bot Response |
|------|-------------|
| ‡∏™‡πà‡∏á‡∏Ç‡πâ‡∏≠‡∏Ñ‡∏ß‡∏≤‡∏°‡∏Å‡πà‡∏≠‡∏ô‡∏¢‡∏∑‡∏ô‡∏¢‡∏±‡∏ô‡∏ï‡∏±‡∏ß‡∏ï‡∏ô | "‡∏Å‡∏£‡∏∏‡∏ì‡∏≤‡∏¢‡∏∑‡∏ô‡∏¢‡∏±‡∏ô‡∏ï‡∏±‡∏ß‡∏ï‡∏ô‡∏Å‡πà‡∏≠‡∏ô‡∏ô‡∏∞ üîê\n ‡∏Å‡∏î‡∏õ‡∏∏‡πà‡∏° '‡∏¢‡∏∑‡∏ô‡∏¢‡∏±‡∏ô‡∏ï‡∏±‡∏ß‡∏ï‡∏ô' ‡∏î‡πâ‡∏≤‡∏ô‡∏•‡πà‡∏≤‡∏á" |
| ‡∏™‡πà‡∏á‡∏Ç‡πâ‡∏≠‡∏Ñ‡∏ß‡∏≤‡∏°‡∏ó‡∏µ‡πà bot ‡πÑ‡∏°‡πà‡πÄ‡∏Ç‡πâ‡∏≤‡πÉ‡∏à | "‡∏Ç‡∏≠‡πÇ‡∏ó‡∏© ‡πÄ‡∏£‡∏≤‡πÑ‡∏°‡πà‡πÄ‡∏Ç‡πâ‡∏≤‡πÉ‡∏à‡∏Ç‡πâ‡∏≠‡∏Ñ‡∏ß‡∏≤‡∏°‡∏ô‡∏µ‡πâ\n ‡∏•‡∏≠‡∏á‡∏Å‡∏î‡πÄ‡∏°‡∏ô‡∏π‡∏î‡πâ‡∏≤‡∏ô‡∏•‡πà‡∏≤‡∏á ‡∏´‡∏£‡∏∑‡∏≠‡∏û‡∏¥‡∏°‡∏û‡πå '‡πÄ‡∏°‡∏ô‡∏π' üìã" |
| Slot ‡∏´‡∏°‡∏î | "‡∏Ç‡∏≠‡∏≠‡∏†‡∏±‡∏¢ ‡∏ä‡πà‡∏ß‡∏á‡πÄ‡∏ß‡∏•‡∏≤‡∏ó‡∏µ‡πà‡πÄ‡∏•‡∏∑‡∏≠‡∏Å‡πÑ‡∏°‡πà‡∏ß‡πà‡∏≤‡∏á‡πÅ‡∏•‡πâ‡∏ß\n ‡∏Å‡∏£‡∏∏‡∏ì‡∏≤‡πÄ‡∏•‡∏∑‡∏≠‡∏Å‡∏ä‡πà‡∏ß‡∏á‡πÄ‡∏ß‡∏•‡∏≤‡∏≠‡∏∑‡πà‡∏ô" |
| ‡∏£‡∏∞‡∏ö‡∏ö error | "‡∏Ç‡∏≠‡∏≠‡∏†‡∏±‡∏¢ ‡∏£‡∏∞‡∏ö‡∏ö‡∏Ç‡∏±‡∏î‡∏Ç‡πâ‡∏≠‡∏á‡∏ä‡∏±‡πà‡∏ß‡∏Ñ‡∏£‡∏≤‡∏ß\n ‡∏Å‡∏£‡∏∏‡∏ì‡∏≤‡∏•‡∏≠‡∏á‡πÉ‡∏´‡∏°‡πà‡∏≠‡∏µ‡∏Å‡∏Ñ‡∏£‡∏±‡πâ‡∏á\n ‡∏´‡∏≤‡∏Å‡∏¢‡∏±‡∏á‡∏°‡∏µ‡∏õ‡∏±‡∏ç‡∏´‡∏≤ ‡πÇ‡∏ó‡∏£ 02-XXX-XXXX" |
| ‡∏ó‡∏≥‡πÅ‡∏ö‡∏ö‡∏õ‡∏£‡∏∞‡πÄ‡∏°‡∏¥‡∏ô‡∏ã‡πâ‡∏≥‡πÉ‡∏ô 30 ‡∏ß‡∏¥ | "‡∏Ñ‡∏∏‡∏ì‡πÄ‡∏û‡∏¥‡πà‡∏á‡∏ó‡∏≥‡πÅ‡∏ö‡∏ö‡∏õ‡∏£‡∏∞‡πÄ‡∏°‡∏¥‡∏ô‡πÑ‡∏õ\n ‡∏î‡∏π‡∏ú‡∏•‡∏•‡πà‡∏≤‡∏™‡∏∏‡∏î‡πÑ‡∏î‡πâ‡∏ó‡∏µ‡πà..." |

---

**End of line_flows.md**
